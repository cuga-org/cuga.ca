# CUGA.ca Website

This repository contains the source code for the Canadian Underwater Games Association (CUGA) website, hosted at [cuga.ca](https://www.cuga.ca).

The site provides information about underwater sports in Canada, primarily focusing on:
*   Underwater Hockey
*   Underwater Rugby
*   Underwater Football

It also features a directory of underwater sports clubs across Canada.

This website is a fork and modification of the original camosub.ca codebase.

## Automated iCalendar Event Generation

This repository includes a system for automatically generating iCalendar (`.ics`) event files from a designated Google Sheet. This system utilizes the Google Gemini API to interpret event data and create structured calendar entries.

### Components

*   **`event_generator.py`**: A Python script responsible for:
    *   Fetching data from the public Google Sheet.
    *   Generating prompts for each event.
    *   Interacting with the Google Gemini API to obtain iCalendar VEVENT components.
    *   Generating individual iCalendar (`.ics`) files for each club (stored in the `club_schedules/` directory).
    *   Creating a comprehensive `master_cuga_schedule.ics` file containing all events from all clubs.
    *   Producing a `cuga_club_data.json` file, which serves as the data source for the `cuga.html` page, containing detailed club information and paths to their respective ICS files.
    *   Tracking processed events to prevent duplicates.
*   **`.github/workflows/generate_calendar.yml`**: A GitHub Actions workflow that:
    *   Automates the execution of `event_generator.py` on a daily schedule.
    *   Can also be triggered manually.
    *   Commits `cuga_club_data.json`, `master_cuga_schedule.ics`, the `club_schedules/` directory (with all per-club ICS files), and `processed_prompts.txt` back to the repository if changes are detected.
*   **`requirements.txt`**: Lists the necessary Python dependencies for the `event_generator.py` script (e.g., `requests`, `icalendar`, `google-generativeai`).
*   **`processed_prompts.txt`**: This file stores a unique fingerprint for each event that has been successfully processed by the Gemini API. The `event_generator.py` script uses this file to avoid reprocessing the same event and making redundant API calls. It is automatically created and managed by the script.
*   **`cuga_club_data.json`**: This JSON file is generated by the script and contains a structured list of all club data, including details like name, location, practice times (EN/FR), notes (EN/FR), and crucially, a path to each club's individual ICS file. The `cuga.html` page now uses this local file as its primary data source.
*   **`master_cuga_schedule.ics`**: A single iCalendar file that aggregates all events from all clubs. This is useful for a comprehensive overview (e.g., for CUGA executives).
*   **`club_schedules/` (directory)**: This directory holds all the individually generated iCalendar (`.ics`) files, with one file per club.

### Website Integration (`cuga.html`)

The `cuga.html` page has been updated to:
*   Fetch club listings and details directly from the locally generated `cuga_club_data.json` file. This means the club information displayed is as current as the last successful run of the event generation workflow.
*   Provide download links for individual club iCalendar schedules, pointing to the respective `.ics` files stored in the `club_schedules/` directory. This replaces the previous client-side ICS generation.

### Google Sheet Data Source

The script currently fetches data from the following public Google Sheet:
[https://docs.google.com/spreadsheets/d/1Lk8Lq5gu-nI1dwZjWZqYM05-x4E-5kD_huPsW-28AMo/gviz/tq](https://docs.google.com/spreadsheets/d/1Lk8Lq5gu-nI1dwZjWZqYM05-x4E-5kD_huPsW-28AMo/gviz/tq)

The script is designed to parse specific columns from this sheet, including but not limited to:
*   `Club Name` (and `Club Name FR` for French)
*   `Province` (and `Province FR`)
*   `City` (and `City FR`)
*   `Practice Location` (and `Practice Location FR`)
*   `Practice Times` (and `Practice Times FR`)
*   `Notes` (and `Notes FR`)
*   `RRULE` (this column is read by the script, but its content is not directly used to generate iCalendar recurrence rules; recurrence is now inferred by the AI from other fields like Practice Times and Notes)

### Gemini API Key Setup

To enable the generation of calendar events using the Gemini API, a valid API key is required.

1.  Obtain a Gemini API key from [Google AI Studio](https://aistudio.google.com/app/apikey).
2.  In your GitHub repository, navigate to `Settings` > `Secrets and variables` > `Actions`.
3.  Create a new repository secret named `GEMINI_API_KEY` and paste your API key as the value.

The GitHub Actions workflow (`generate_calendar.yml`) is configured to use this secret to authenticate with the Gemini API. If the `GEMINI_API_KEY` is not provided, the script will skip live API calls and use mock data, resulting in placeholder calendar events.

### Workflow Operation

*   **Triggers**: The workflow runs automatically every day at midnight UTC. It can also be manually triggered from the Actions tab in the GitHub repository.
*   **Process**:
    1.  Checks out the latest code.
    2.  Sets up a Python environment and installs dependencies.
    3.  Executes `event_generator.py` (using the `GEMINI_API_KEY`).
    4.  If `cuga_club_data.json`, `master_cuga_schedule.ics`, files within `club_schedules/`, or `processed_prompts.txt` have been modified by the script, the workflow commits these changes back to the main branch of the repository.

### Output

The primary outputs of this system are:
*   **`cuga_club_data.json`**: The local JSON data file used by `cuga.html`.
*   **`master_cuga_schedule.ics`**: A master iCalendar file with all club events.
*   **`club_schedules/`**: A directory containing individual iCalendar files for each club.
These files are updated automatically by the workflow.

## Website Pages and Features

This website includes the following key pages:

*   **`index.html`**: The main landing page with information about CUGA, its sports disciplines (Underwater Hockey, Rugby, and Football), club listings, and contact information. It features a language switcher for English and French content.
*   **`cuga.html`**: Lists CUGA affiliated clubs across Canada. (Note: This page might be integrated or superseded by dynamic club listings on `index.html` in future updates).
*   **`join.html`**: Provides detailed information about CUGA membership options, benefits, and the process for joining.
    *   **Fully Bilingual**: Content is available in English and French, with a language switcher and auto-detection.
    *   **Streamlined Process**: The previous placeholder PayPal button has been removed. Instead, a clear call-to-action button directs users to the `waiver.html` page to start their application.
*   **`waiver.html`**: An interactive membership application and waiver form that allows users to:
    *   Enter their personal and emergency contact details.
    *   Provide their club name (optional) and select sports played (Underwater Hockey, Rugby, Football) via checkboxes.
    *   Select a membership type (Adult, Youth, New Player).
    *   View dynamically calculated membership fees, including logic for early bird pricing (before March 1st) versus regular season pricing.
    *   View the full official CUGA waiver text within a scrollable area on the page.
    *   Provide their initials in a dedicated input field, as required by the waiver text.
    *   Sign digitally using an interactive signature pad (implemented with `signature_pad.js` library via CDN). Functionality includes a "Clear Signature" button and a fallback to a typed signature input if the library fails to load.
    *   Electronically agree to the CUGA Code of Conduct and the terms of the waiver via checkboxes.
    *   **Fully Bilingual Interface**: The entire page, including form labels, dynamic messages, and buttons, is available in English and French, with a language switcher and auto-detection based on browser preference.
    *   **Simulated Google Pay Integration**: The form features a "Pay with Google Pay" button. This is a **front-end simulation only** and does **not** process any real financial transactions or connect to Google Pay services.
    *   **Enhanced Simulated Data Submission & Confirmation**:
        *   Upon completing the form and "payment" (or for $0 fee memberships), an on-page confirmation message is displayed bilingually, indicating success and outlining fictional next steps (e.g., "You will receive a confirmation email shortly").
        *   The main form sections are hidden, and options are provided to "Start a new application" (which resets the form and view) or "Go to Homepage".
        *   Member data is **not** actually sent to a Google Drive sheet. Instead, the collected data is logged to the browser's developer console. This data includes all form fields: personal details, club name, selected sports (as a comma-separated string if multiple), membership type, calculated fee, waiver initials, the signature (as a Base64 data URL from the canvas, or typed text if fallback was used), the printed name for the signature, and a timestamp of the submission. The form is then reset.
    *   *Note on Waiver Presentation*: The signature is captured against the waiver text displayed as HTML content within a scrollable section. The stretch goal to render the full waiver text onto a single, combined image canvas with the signature for download was not implemented due to its complexity.

**Common Elements:**
*   **Language Selector**: All main pages (`index.html`, `join.html`, `waiver.html`) feature a language selector allowing users to switch between English and French content. The site also attempts to auto-detect and set the language based on browser preference on initial load.
*   **Prototype Disclaimer**: The prototype disclaimer banner, providing a link to the official `cuga.org` website, is consistently displayed at the top of `index.html`, `join.html`, and `waiver.html`. It is positioned after the language selector and before the main page header for site-wide visibility.

**Important Note on Simulations:** The payment and data submission functionalities on `waiver.html` are currently client-side simulations. No real payments are processed, and no data is transmitted to a live backend or cloud storage. These features are implemented to showcase the intended user workflow.
