<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CUGA - Canadian Underwater Games Association | Underwater Sports</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="assets/fontawesome/css/font-awesome.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="preload" as="image" href="images/hockey.jpg">
    <link rel="preload" as="image" href="images/rugby.jpg">
    <link rel="preload" as="image" href="images/hockey-drill.jpg">
    <link rel="preload" as="image" href="images/rugby-drill.jpg">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9V8Q4XJXLD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9V8Q4XJXLD');
    </script>
    <meta name="description" content="CUGA - Découvrez les sports subaquatiques au Canada, incluant le hockey et le rugby subaquatique. Rejoignez-nous pour des entraînements et des cours d'initiation.">
    <meta name="keywords" content="CUGA, Canadian Underwater Games Association, sports subaquatiques, hockey subaquatique, rugby subaquatique, Canada, national, cours d'initiation, entraînements, club, natation, snorkeling, sports, hockey sous-marin, rugby sous-marin, sport aquatique, loisir aquatique, sport collectif, apnée, plongée, compétition, équipe, jeunes, adultes, sport santé, activité physique, sport d'équipe, sport de piscine, sport sous l'eau, formation, découverte, sport loisir, sport Québec, sport Canada, underwater hockey, underwater rugby, aquatic sports, underwater club, swimming pool, aquatic training, aquatic fitness, aquatic competition, aquatic team, aquatic club, aquatic activities, aquatic leisure, aquatic challenge, aquatic discipline, aquatic event, aquatic fun, aquatic games, aquatic initiation, aquatic learning, aquatic practice, aquatic recreation, aquatic sport, aquatic team sport, aquatic training, aquatic youth, aquatic adults, aquatic wellness, aquatic workout, aquatic experience, aquatic adventure, aquatic discovery, aquatic Quebec, aquatic Canada, sport jeunesse, sport adulte, sport mixte, sport féminin, sport masculin, sport inclusif, sport récréatif, sport compétitif, sport loisir Québec, sport loisir Canada, club aquatique, club loisir, club compétition, club jeunesse, club adulte, club inclusif, club Québec, club Canada, activité aquatique, activité sportive, activité loisir, activité jeunesse, activité adulte, activité famille, activité Québec, activité Canada, entraînement aquatique, entraînement sportif, entraînement loisir, entraînement jeunesse, entraînement adulte, entraînement Québec, entraînement Canada, underwater sports, underwater hockey, underwater rugby, introductory course, training, club, swimming, aquatic sports, underwater team, team sport, apnea, diving, competition, team, youth, adults, health sport, physical activity, team sport, pool sport, underwater sport, training, discovery, leisure sport, Quebec sport, Canada sport, youth sport, adult sport, mixed sport, women's sport, men's sport, inclusive sport, recreational sport, competitive sport, leisure club, competition club, youth club, adult club, inclusive club, Quebec club, Canada club, aquatic activity, sports activity, leisure activity, youth activity, adult activity, family activity, Quebec activity, Canada activity, aquatic training, sports training, leisure training, youth training, adult training, Quebec training, Canada training">
    <meta name="author" content="CUGA - Canadian Underwater Games Association">
    <meta property="og:title" content="CUGA - Sports Subaquatiques au Canada">
    <meta property="og:description" content="Rejoignez CUGA pour découvrir le hockey et le rugby subaquatique au Canada. Inscrivez-vous à nos cours d'initiation et plongez dans l'action !">
    <meta property="og:image" content="images/hockey.jpg">
    <meta property="og:url" content="https://www.cuga.ca">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CUGA - Sports Subaquatiques au Canada">
    <meta name="twitter:description" content="Découvrez les sports subaquatiques avec CUGA au Canada. Hockey et rugby subaquatique pour tous les niveaux.">
    <meta name="twitter:image" content="images/hockey.jpg">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* French content shown by default (as per html[lang=fr]). English content hidden initially. JS manages language switching. */
        .lang-en {
            display: none; /* Hide English content by default to prevent flash and provide a no-JS fallback */
        }

        /* Styles from cuga.html */
        #language-selection, #filter-controls {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #fff; /* Changed from #f4f4f4 to #fff for better contrast on potentially dark bg */
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: #333; /* Ensure text color is dark for readability on light background */
        }

        #language-selection button,
        #filter-controls select,
        #filter-controls label {
            padding: 8px 12px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            font-size: 14px;
            color: #333; /* Ensure text color for controls */
        }

        #language-selection button:hover,
        #filter-controls select:hover {
            background-color: #e9e9e9;
        }

        #filter-controls label {
            border: none; /* Labels shouldn't look like buttons */
            cursor: default;
            padding-left: 0;
        }

        #clubs-container table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: #333; /* Ensure text color for table content */
        }

        #clubs-container th, #clubs-container td {
            padding: 12px 15px;
            border: 1px solid #ddd;
            text-align: left;
            vertical-align: top;
        }

        #clubs-container th {
            background-color: #2c3e50; /* Dark blue-gray for header */
            color: #fff;
            font-weight: bold;
        }

        #clubs-container tr:hover {
            background-color: #f0f0f0; /* Light gray for row hover */
        }

        #clubs-container td.no-clubs-message {
            text-align: center;
            font-style: italic;
            padding: 20px;
            background-color: #fff;
        }

        #clubs-container .ics-button {
            padding: 5px 8px;
            background-color: #27ae60; /* Green for ICS button */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            min-width: 30px;
            text-align: center;
            margin-right: 8px;
            margin-bottom: 4px;
            vertical-align: middle;
        }

        #clubs-container .ics-button:disabled {
            background-color: #bdc3c7; /* Gray for disabled ICS button */
            cursor: not-allowed;
        }

        #clubs-container .ics-button:hover:not(:disabled) {
            background-color: #229954; /* Darker green on hover */
        }

        .link-icon {
            vertical-align: middle;
        }

        .link-icon i {
            color: inherit;
            font-size: 18px;
            vertical-align: middle;
        }

        a.link-icon-anchor {
            display: inline-block;
            text-decoration: none;
            color: #337ab7; /* Standard link blue */
            margin-right: 8px;
            margin-bottom: 4px;
            padding: 2px;
        }

        a.link-icon-anchor:hover {
            color: #23527c; /* Darker blue on hover */
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            AOS.init({
                duration: 1000, // Durée de l'animation en millisecondes
                once: true, // Animation uniquement lors du premier défilement
            });
        });
    </script>
    <style>
        .bubbles {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            opacity: 0.7;
            animation: rise 10s infinite ease-in;
        }

        @keyframes rise {
            0% {
                bottom: -100px;
                transform: translateX(0);
            }
            50% {
                transform: translateX(100px);
            }
            100% {
                bottom: 1080px;
                transform: translateX(-100px);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-blue-700 text-white">
    <div class="bubbles">
    </div>

    <div class="text-center py-4 bg-gray-200">
        <button class="lang-button px-4 py-2 mr-2 rounded bg-blue-500 text-white" data-lang="fr">
            <i class="fa fa-fleur-de-lis"></i> Français
        </button>
        <button class="lang-button px-4 py-2 rounded bg-gray-400 text-gray-800" data-lang="en">
            <i class="fa fa-canadian-maple-leaf"></i> English
        </button>
    </div>

    <div class="lang-fr">
        <header class="bg-[#386DC0] text-white py-8 text-center shadow-lg">
            <div class="mx-auto text-2xl font-bold">CUGA</div>
            <p class="mt-1 text-md md:text-lg italic">Association Canadienne des Jeux Subaquatiques</p>
            <p class="mt-1 text-md md:text-lg italic">Plongez dans l'action avec le Hockey et le Rugby Subaquatique !</p>
        </header>

        <div id="french-events-container"></div>

        <section id="sports" class="container mx-auto px-4 py-16" data-aos="fade-up">
            <h2 class="text-3xl md:text-4xl font-semibold text-center mb-12 text-gray-800">Découvrez Nos Disciplines</h2>

            <div class="flex flex-col md:flex-row gap-10">
                <div class="bg-white rounded-xl shadow-xl p-8 w-full md:w-1/2 transform transition duration-500 hover:scale-105 hover:shadow-2xl" data-aos="fade-up" data-aos-delay="100">
                    <h3 class="text-2xl font-bold mb-4 text-blue-800 flex items-center text-center">
                        Hockey Subaquatique
                    </h3>
                    <img src="images/logos/uwh-logo.jpg" alt="Logo Hockey Subaquatique Pleine Taille" class="w-full max-w-xs mx-auto mb-6 rounded bg-white shadow" />
                    <img src="images/hockey.jpg" alt="Image de joueurs de Hockey Subaquatique" class="rounded-lg mb-6 w-full h-auto object-cover">
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Le hockey subaquatique est un sport d'équipe non-contact pratiqué au fond d'une piscine. Deux équipes de six joueurs s'affrontent pour pousser un palet lourd à l'aide d'une crosse dans le but adverse. C'est un sport intense qui demande apnée, endurance et stratégie.
                        <br><br>
                        Ce sport développe l'apnée, la force physique, l'agilité sous l'eau et la coordination d'équipe. Il est parfait pour ceux qui aiment les défis aquatiques et la collaboration.
                    </p>
                    <p class="text-lg font-semibold text-gray-900 mt-4">Des clubs existent à travers le Canada.</p>
                    <a href="#entrainement-hockey" class="mt-6 inline-block bg-blue-700 text-white px-8 py-3 rounded-full font-semibold hover:bg-blue-800 transition duration-300 shadow-lg">Voir l'entraînement d'initiation</a>
                </div>

                <div class="bg-white rounded-xl shadow-xl p-8 w-full md:w-1/2 transform transition duration-500 hover:scale-105 hover:shadow-2xl" data-aos="fade-up" data-aos-delay="200">
                    <h3 class="text-2xl font-bold mb-4 text-green-800 flex items-center text-center">
                        Rugby Subaquatique
                    </h3>
                    <img src="images/logos/uwr-logo.jpg" alt="Logo Rugby Subaquatique Pleine Taille" class="w-full max-w-xs mx-auto mb-6 rounded bg-white shadow" />
                    <img src="images/rugby.jpg" alt="Image de joueurs de Rugby Subaquatique" class="rounded-lg mb-6 w-full h-auto object-cover">
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Le rugby subaquatique est un sport d'équipe en trois dimensions joué au fond d'une piscine profonde. Deux équipes tentent de placer un ballon rempli d'eau salée (qui coule) dans le panier adverse. Les contacts sont autorisés pour prendre le ballon au porteur.
                        <br><br>
                        Ce sport développe l'apnée, la puissance, la tactique spatiale et la capacité à travailler en équipe dans un environnement unique. Il est idéal pour les athlètes cherchant un sport aquatique intense et stratégique.
                    </p>
                    <p class="text-lg font-semibold text-gray-900 mt-4">Des clubs existent à travers le Canada.</p>
                    <a href="#entrainement-rugby" class="mt-6 inline-block bg-green-700 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-800 transition duration-300 shadow-lg">Voir l'entraînement d'initiation</a>
                </div>
            </div>
        </section>


        <section id="entrainement" class="bg-gray-200 px-4 py-16" data-aos="fade-up">
            <div class="container mx-auto">
                <h2 class="text-3xl md:text-4xl font-semibold text-center mb-12 text-gray-800">Entraînements d'Initiation Simples</h2>

                <div id="entrainement-hockey" class="bg-white rounded-xl shadow-lg p-8 mb-10" data-aos="fade-up" data-aos-delay="100">
                    <h3 class="text-2xl font-bold mb-4 text-blue-800">Initiation au Hockey Subaquatique</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Découvrez les mouvements de base et la manipulation du palet sous l'eau.
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Échauffement dans l'eau (nage douce, battements de jambes).</li>
                        <li>Exercices d'apnée statique et dynamique (courtes distances).</li>
                        <li>Familiarisation avec l'équipement (palmes, masque, tuba, crosse, palet).</li>
                        <li>Drills de poussée du palet au fond de la piscine.</li>
                        <li>Drills simples de passes entre partenaires.</li>
                        <li>Petits matchs simulés pour appliquer les bases.</li>
                    </ul>
                    <img src="images/hockey-drill.jpg" alt="Illustration d'exercice Hockey Subaquatique" class="rounded-md mt-8 w-full h-auto object-cover">
                </div>

                <div id="entrainement-rugby" class="bg-white rounded-xl shadow-lg p-8" data-aos="fade-up" data-aos-delay="200">
                    <h3 class="text-2xl font-bold mb-4 text-green-800">Initiation au Rugby Subaquatique</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Apprenez à vous déplacer en 3D et à interagir avec le ballon et les adversaires.
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Échauffement et nage en profondeur.</li>
                        <li>Exercices d'apnée en mouvement et de descente rapide.</li>
                        <li>Familiarisation avec le ballon et les paniers.</li>
                        <li>Drills de passes et de réception du ballon sous l'eau.</li>
                        <li>Exercices de positionnement et de déplacement en 3D.</li>
                        <li>Introduction aux règles de contact et simulations de jeu.</li>
                    </ul>
                    <img src="images/rugby-drill.jpg" alt="Illustration d'exercice Rugby Subaquatique" class="rounded-md mt-8 w-full h-auto object-cover">
                </div>

            </div>
        </section>

         <section id="contact" class="bg-gray-800 text-white px-4 py-16">
            <div class="container mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-semibold mb-8">Contactez CUGA</h2>
                <p class="text-lg mb-8">
                    Prêt(e) à plonger ? Contactez-nous pour plus d'informations ou pour vous inscrire à des cours d'initiation !
                </p>
                <div class="flex flex-col items-center space-y-4">
                    <p class="text-xl"><span class="font-semibold"><i class="fa fa-envelope"></i> Email Général :</span> <a href="mailto:info@cuga.ca" class="text-blue-400 hover:underline">info@cuga.ca</a></p>
                    <p class="text-xl"><span class="font-semibold"><i class="fa fa-envelope"></i> Email Hockey Subaquatique :</span> <a href="mailto:cuga_uwh@example.com" class="text-blue-400 hover:underline">cuga_uwh@example.com</a></p>
                    <p class="text-xl"><span class="font-semibold"><i class="fa fa-envelope"></i> Email Rugby Subaquatique :</span> <a href="mailto:cuga_uwr@example.com" class="text-blue-400 hover:underline">cuga_uwr@example.com</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-facebook"></i> Facebook Hockey Subaquatique :</span> <a href="https://www.facebook.com/CUGAhockeysousmarin/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">CUGAhockeysousmarin</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-facebook"></i> Facebook Rugby Subaquatique :</span> <a href="https://www.facebook.com/uwr.cuga/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">uwr.cuga</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-instagram"></i> Instagram Rugby Subaquatique :</span> <a href="https://www.instagram.com/uwr.cuga/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">uwr.cuga</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-instagram"></i> Instagram Hockey Subaquatique :</span> <a href="https://www.instagram.com/cuga.underwater/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">cuga.underwater</a></p>
                </div>
            </div>
        </section>


        <footer class="bg-gray-900 text-gray-400 py-8 text-center">
            <div class="container mx-auto px-4">
                <p class="mt-2 flex flex-wrap justify-center gap-2 items-center">
                    <span>
                        <i class="fa fa-flag-quebec text-blue-200 mr-1"></i>
                        <a href="https://quebecsubaquatique.ca/hockey-subaquatique/" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            Hockey subaquatique Québec
                        </a>
                    </span>
                    <span class="mx-2">|</span>
                    <span>
                        <i class="fa fa-canadian-maple-leaf text-red-500 mr-1"></i>
                        <a href="https://cuga.org/fr/" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            Association Canadienne des Jeux Sous-Marins
                        </a>
                    </span>
                    <span class="mx-2">|</span>
                    <span>
                        <i class="fa fa-globe text-green-200 mr-1"></i>
                        <a href="https://www.cmas.org/hockey/latest.html" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            CMAS Hockey subaquatique
                        </a>
                    </span>
                    <span class="mx-2">|</span>
                    <span>
                        <i class="fa fa-globe text-green-200 mr-1"></i>
                        <a href="https://www.cmas.org/rugby/latest.html" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            CMAS Rugby subaquatique
                        </a>
                    </span>
                </p>
            </div>
            <div class="container mx-auto px-4">
                <p>&copy; 2025 CUGA. Tous droits réservés.</p>
                <p class="mt-4">
                    <a href="privacy-policy.html" class="text-blue-400 hover:underline">Politique de Confidentialité</a> |
                    <a href="terms-of-use.html" class="text-blue-400 hover:underline">Conditions d'Utilisation</a>
                </p>
            </div>
        </footer>
    </div>

    <div class="lang-en">
        <header class="bg-[#386DC0] text-white py-8 text-center shadow-lg">
            <div class="mx-auto text-2xl font-bold">CUGA</div>
            <p class="mt-1 text-md md:text-lg italic">Canadian Underwater Games Association</p>
            <p class="mt-1 text-md md:text-lg italic">Dive into the action with Underwater Hockey and Underwater Rugby!</p>
        </header>

        <div id="english-events-container"></div>

        <section id="sports-en" class="container mx-auto px-4 py-16" data-aos="fade-up">
            <h2 class="text-3xl md:text-4xl font-semibold text-center mb-12 text-gray-800">Discover Our Disciplines</h2>

            <div class="flex flex-col md:flex-row gap-10">

                <div class="bg-white rounded-xl shadow-xl p-8 w-full md:w-1/2 transform transition duration-500 hover:scale-105 hover:shadow-2xl" data-aos="fade-up" data-aos-delay="100">
                    <h3 class="text-2xl font-bold mb-4 text-blue-800 flex items-center">
                        <img src="images/logos/uwh-logo.jpg" alt="Underwater Hockey Logo" class="w-8 h-8 rounded bg-white shadow mr-2" />
                        Underwater Hockey
                    </h3>
                    <img src="images/logos/uwh-logo.jpg" alt="Underwater Hockey Full Logo" class="w-full max-w-xs mx-auto mb-6 rounded bg-white shadow" />
                    <img src="images/hockey.jpg" alt="Image of Underwater Hockey players" class="rounded-lg mb-6 w-full h-auto object-cover">
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Underwater hockey is a non-contact team sport played on the bottom of a swimming pool. Two teams of six players compete to push a heavy puck using a stick into the opponent's goal. It's an intense sport that requires breath-holding, endurance, and strategy.
                        <br><br>
                        This sport develops breath-holding, physical strength, underwater agility, and team coordination. It's perfect for those who enjoy aquatic challenges and collaboration.
                    </p>
                    <p class="text-lg font-semibold text-gray-900 mt-4">Clubs exist across Canada.</p>
                    <a href="#entrainement-hockey-en" class="mt-6 inline-block bg-blue-700 text-white px-8 py-3 rounded-full font-semibold hover:bg-blue-800 transition duration-300 shadow-lg">See introductory training</a>
                </div>

                <div class="bg-white rounded-xl shadow-xl p-8 w-full md:w-1/2 transform transition duration-500 hover:scale-105 hover:shadow-2xl" data-aos="fade-up" data-aos-delay="200">
                    <h3 class="text-2xl font-bold mb-4 text-green-800 flex items-center">
                        <img src="images/logos/uwr-logo.jpg" alt="Underwater Rugby Logo" class="w-8 h-8 rounded bg-white shadow mr-2" />
                        Underwater Rugby
                    </h3>
                    <img src="images/logos/uwr-logo.jpg" alt="Underwater Rugby Full Logo" class="w-full max-w-xs mx-auto mb-6 rounded bg-white shadow" />
                    <img src="images/rugby.jpg" alt="Image of Underwater Rugby players" class="rounded-lg mb-6 w-full h-auto object-cover">
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Underwater rugby is a three-dimensional team sport played at the bottom of a deep pool. Two teams try to place a saltwater-filled ball (which sinks) into the opponent's basket. Contact is allowed to take the ball from the ball carrier.
                        <br><br>
                        This sport develops breath-holding, power, spatial tactics, and the ability to work as a team in a unique environment. It's ideal for athletes seeking an intense and strategic aquatic sport.
                    </p>
                    <p class="text-lg font-semibold text-gray-900 mt-4">Clubs exist across Canada.</p>
                     <a href="#entrainement-rugby-en" class="mt-6 inline-block bg-green-700 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-800 transition duration-300 shadow-lg">See introductory training</a>
                </div>

            </div>
        </section>


        <section id="entrainement-en" class="bg-gray-200 px-4 py-16" data-aos="fade-up">
            <div class="container mx-auto">
                <h2 class="text-3xl md:text-4xl font-semibold text-center mb-12 text-gray-800">Simple Introductory Trainings</h2>

                <div id="entrainement-hockey-en" class="bg-white rounded-xl shadow-lg p-8 mb-10" data-aos="fade-up" data-aos-delay="100">
                    <h3 class="text-2xl font-bold mb-4 text-blue-800">Introduction to Underwater Hockey</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Discover the basic movements and puck handling underwater.
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Warm-up in the water (light swimming, butt kicks, high knees).</li>
                        <li>Static and dynamic breath-holding exercises (short distances).</li>
                        <li>Familiarization with equipment (fins, mask, snorkel, stick, puck).</li>
                        <li>Puck pushing drills on the pool bottom.</li>
                        <li>Simple passing drills with partners.</li>
                        <li>Small simulated games to apply the basics.</li>
                    </ul>
                    <img src="images/hockey-drill.jpg" alt="Illustration of Underwater Hockey drill" class="rounded-md mt-8 w-full h-auto object-cover">
                </div>

                <div id="entrainement-rugby-en" class="bg-white rounded-xl shadow-lg p-8" data-aos="fade-up" data-aos-delay="200">
                    <h3 class="text-2xl font-bold mb-4 text-green-800">Introduction to Underwater Rugby</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Learn to move in 3D and interact with the ball and opponents.
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Warm-up and deep water swimming.</li>
                        <li>Moving breath-holding and rapid descent exercises.</li>
                        <li>Familiarization with the ball and baskets.</li>
                        <li>Passing and receiving drills underwater.</li>
                        <li>Positioning and 3D movement exercises.</li>
                        <li>Introduction to contact rules and game simulations.</li>
                    </ul>
                    <img src="images/rugby-drill.jpg" alt="Illustration of Underwater Rugby drill" class="rounded-md mt-8 w-full h-auto object-cover">
                </div>

            </div>
        </section>

         <section id="contact-en" class="bg-gray-800 text-white px-4 py-16">
            <div class="container mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-semibold mb-8">Contact CUGA</h2>
                <p class="text-lg mb-8">
                    Ready to dive in? Contact us for more information or to register for introductory courses!
                </p>
                <div class="flex flex-col items-center space-y-4">
                    <p class="text-xl"><span class="font-semibold"><i class="fa fa-envelope"></i> General Email:</span> <a href="mailto:info@cuga.ca" class="text-blue-400 hover:underline">info@cuga.ca</a></p>
                    <p class="text-xl"><span class="font-semibold"><i class="fa fa-envelope"></i> Underwater Hockey Email:</span> <a href="mailto:cuga_uwh@example.com" class="text-blue-400 hover:underline">cuga_uwh@example.com</a></p>
                    <p class="text-xl"><span class="font-semibold"><i class="fa fa-envelope"></i> Underwater Rugby Email:</span> <a href="mailto:cuga_uwr@example.com" class="text-blue-400 hover:underline">cuga_uwr@example.com</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-facebook"></i> Underwater Hockey Facebook:</span> <a href="https://www.facebook.com/CUGAhockeysousmarin/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">CUGAhockeysousmarin</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-facebook"></i> Underwater Rugby Facebook:</span> <a href="https://www.facebook.com/uwr.cuga/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">uwr.cuga</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-instagram"></i> Underwater Rugby Instagram:</span> <a href="https://www.instagram.com/uwr.cuga/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">uwr.cuga</a></p>
                     <p class="text-xl"><span class="font-semibold"><i class="fa fa-instagram"></i> Underwater Hockey Instagram:</span> <a href="https://www.instagram.com/cuga.underwater/" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">cuga.underwater</a></p>
                </div>
            </div>
        </section>


        <footer class="bg-gray-900 text-gray-400 py-8 text-center">
            <div class="container mx-auto px-4">
                <p class="mt-2 flex flex-wrap justify-center gap-2 items-center">
                    <span>
                        <i class="fa fa-flag-quebec text-blue-200 mr-1"></i>
                        <a href="https://quebecsubaquatique.ca/en/hockey-subaquatique/" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            Underwater hockey Quebec
                        </a>
                    </span>
                    <span class="mx-2">|</span>
                    <span>
                        <i class="fa fa-canadian-maple-leaf text-red-500 mr-1"></i>
                        <a href="https://cuga.org/en/" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            CUGA (Canadian Underwater Games Association)
                        </a>
                    </span>
                    <span class="mx-2">|</span>
                    <span>
                        <i class="fa fa-globe text-green-200 mr-1"></i>
                        <a href="https://www.cmas.org/hockey/latest.html" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            CMAS Underwater Hockey
                        </a>
                    </span>
                    <span class="mx-2">|</span>
                    <span>
                        <i class="fa fa-globe text-green-200 mr-1"></i>
                        <a href="https://www.cmas.org/rugby/latest.html" target="_blank" rel="noopener noreferrer" class="underline text-blue-200 hover:text-white font-semibold">
                            CMAS Underwater Rugby
                        </a>
                    </span>
                </p>
            </div>
            <div class="container mx-auto px-4">
                <p>&copy; 2025 CUGA. All rights reserved.</p>
                <p class="mt-4">
                    <a href="privacy-policy.html" class="text-blue-400 hover:underline">Privacy Policy</a> |
                    <a href="terms-of-use.html" class="text-blue-400 hover:underline">Terms of Use</a>
                </p>
            </div>
        </footer>
    </div>

    <section id="cuga-club-list" class="container mx-auto px-4 py-16 bg-gray-100 text-gray-800">
        <h2 class="text-3xl md:text-4xl font-semibold text-center mb-12 text-gray-800">CUGA Clubs</h2>
        <div id="language-selection" class="text-center mb-4">
            <button id="lang-en-clubs" class="lang-button-clubs px-4 py-2 mr-2 rounded bg-blue-500 text-white">English</button>
            <button id="lang-fr-clubs" class="lang-button-clubs px-4 py-2 rounded bg-gray-400 text-gray-800">Français</button>
        </div>
        <div id="filter-controls" class="text-center mb-4">
            <!-- Filter controls will be added here by JS -->
        </div>
        <div id="clubs-container">
            <!-- Club listings will be displayed here by JS -->
        </div>
    </section>

    <script>
  document.addEventListener('DOMContentLoaded', function() {
    function appendVersionInfoToFooters(element) {
      const selectors = ['.lang-fr footer .container:last-of-type', '.lang-en footer .container:last-of-type'];
      selectors.forEach(selector => {
        const footerContainer = document.querySelector(selector);
        if (footerContainer) {
          footerContainer.appendChild(element.cloneNode(true));
        }
      });
    }

    function createVersionElement(text, isError) {
      const versionP = document.createElement('p');
      // Tailwind classes for styling:
      // text-xs: font-size: 0.75rem; line-height: 1rem; (close to 0.8em)
      // text-center: text-align: center;
      // mt-4: margin-top: 1rem; (16px, close to 15px)
      // pt-2: padding-top: 0.5rem; (8px, close to 10px)
      // border-t: border-top-width: 1px;
      // border-gray-600: border-color: #4A5568; (Tailwind's gray-600)
      versionP.classList.add('text-xs', 'text-center', 'mt-4', 'pt-2', 'border-t', 'border-gray-600');
      versionP.textContent = text;
      if (isError) {
        // text-red-600: color: #E53E3E; (Tailwind's red-600)
        versionP.classList.add('text-red-600');
      } else {
        // text-gray-500: color: #6B7280; (Tailwind's gray-500, #A0AEC0 is also gray-500 in some palettes or gray-400 in others)
        // Using text-gray-500 for a common light-ish text on dark footer.
        versionP.classList.add('text-gray-500');
      }
      return versionP;
    }

    fetch('version.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('version.json not found or invalid');
        }
        return response.json();
      })
      .then(data => {
        const versionText = `Version: Branch: ${data.branch || 'main'} | Commit: ${data.commit ? data.commit.substring(0, 7) : 'N/A'}`;
        const versionElement = createVersionElement(versionText, false);
        appendVersionInfoToFooters(versionElement);
      })
      .catch(error => {
        console.warn('Could not load version information:', error);
        const errorText = 'Version info not available';
        const errorElement = createVersionElement(errorText, true);
        appendVersionInfoToFooters(errorElement);
      });
  });
</script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const langButtons = document.querySelectorAll('.lang-button');
            const langSections = document.querySelectorAll('.lang-fr, .lang-en');

            const setLanguage = (lang) => {
                langSections.forEach(section => {
                    section.style.display = section.classList.contains(`lang-${lang}`) ? 'block' : 'none';
                });
                langButtons.forEach(button => {
                    button.classList.toggle('bg-blue-500', button.dataset.lang === lang);
                    button.classList.toggle('text-white', button.dataset.lang === lang);
                    button.classList.toggle('bg-gray-400', button.dataset.lang !== lang);
                    button.classList.toggle('text-gray-800', button.dataset.lang !== lang);
                });
                document.documentElement.lang = lang;
            };

            // Auto-detect browser language
            const browserLang = (navigator.language || navigator.userLanguage || 'fr').slice(0, 2);

if (browserLang === 'en') {
    setLanguage('en');
} else {
    // Default to French for 'fr' or any other detected language not explicitly handled as 'en'
    setLanguage('fr');
}

            langButtons.forEach(button => {
                button.addEventListener('click', () => setLanguage(button.dataset.lang));
            });

            // The initial setLanguage call based on default 'fr' is now handled by the auto-detection logic.
            // If no specific language is detected and matches 'en' or 'fr', it defaults to 'fr'.
        });
    </script>
    <script>
        // Script to dynamically load events
        document.addEventListener('DOMContentLoaded', () => {
            const frenchEventsContainer = document.getElementById('french-events-container');
            const englishEventsContainer = document.getElementById('english-events-container');

            // Define background classes for events based on their ID or order
            const eventBackgroundClasses = {
                "canadians-2025": "bg-green-100",
                "newbie-training": "bg-yellow-500",
                "summer-tournament-2025": "bg-blue-100"
            };

            function parseISODateStringToDate(dateString) {
                if (!dateString) return null;
                const parts = dateString.split('-');
                if (parts.length === 3) {
                    const year = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10) - 1; // Month is 0-indexed in JavaScript Date
                    const day = parseInt(parts[2], 10);
                    return new Date(Date.UTC(year, month, day)); // Use UTC to avoid timezone shifts from midnight
                }
                return null;
            }

            function renderEvent(event, lang) {
                const eventLangData = event[lang];
                if (!eventLangData) return ''; // Skip if no language-specific data

                const section = document.createElement('section');
                section.id = `event-${event.id}-${lang}`;
                // Use the same background class for fr and en versions of the same event type
                const bgClass = eventBackgroundClasses[event.id] || 'bg-gray-100'; // Default bg if not specified
                section.className = `${bgClass} text-gray-900 px-4 py-16 text-center shadow-inner`;

                const containerDiv = document.createElement('div');
                containerDiv.className = 'container mx-auto';

                const title = document.createElement('h1');
                title.className = 'text-3xl md:text-4xl font-bold mb-6';
                title.textContent = eventLangData.title;
                containerDiv.appendChild(title);

                if (event.image) {
                    const img = document.createElement('img');
                    img.src = event.image;
                    img.alt = eventLangData.title; // Use event title as alt text
                    img.className = 'mx-auto mb-6 rounded-lg shadow-lg max-w-full md:max-w-2xl';
                    containerDiv.appendChild(img);
                }

                // For newbie training's specific paragraph before the white box
                if (event.id === 'newbie-training' && eventLangData.description) {
                     const introParagraph = document.createElement('p');
                     introParagraph.className = 'text-xl md:text-2xl mb-8';
                     introParagraph.textContent = eventLangData.description; // This is the main description for newbie training.
                     containerDiv.appendChild(introParagraph);
                }


                const contentWrapperDiv = document.createElement('div');
                contentWrapperDiv.className = 'bg-white rounded-lg shadow-lg p-8 inline-block max-w-xl text-left';

                // Date/Time display
                const dateP = document.createElement('p');
                dateP.className = 'text-2xl font-semibold mb-4';
                const dateLabelSpan = document.createElement('span'); // For "Date: " or "Quand: "
                const dateValueSpan = document.createElement('span'); // For the actual date value
                dateValueSpan.className = 'text-red-600';

                if (event.recurrence && event.recurrence[lang]) {
                    dateLabelSpan.textContent = lang === 'fr' ? 'Quand : ' : 'When: ';
                    dateValueSpan.textContent = event.recurrence[lang];
                } else if (event.startDate) {
                    dateLabelSpan.textContent = lang === 'fr' ? 'Date : ' : 'Date: ';
                    const locale = lang === 'fr' ? 'fr-CA' : 'en-CA';
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' }; // Ensure UTC for consistency

                    const startDateObj = parseISODateStringToDate(event.startDate);
                    let formattedStartDate = '';
                    if(startDateObj) {
                        formattedStartDate = startDateObj.toLocaleDateString(locale, options);
                    } else {
                        formattedStartDate = event.startDate; // Fallback
                    }

                    if (event.endDate && event.endDate !== event.startDate) {
                        const endDateObj = parseISODateStringToDate(event.endDate);
                        let formattedEndDate = '';
                        if(endDateObj){
                            formattedEndDate = endDateObj.toLocaleDateString(locale, options);
                        } else {
                            formattedEndDate = event.endDate; // Fallback
                        }
                        dateValueSpan.textContent = `${formattedStartDate} - ${formattedEndDate}`;
                    } else {
                        dateValueSpan.textContent = formattedStartDate;
                    }
                }

                if (dateValueSpan.textContent) { // Only append if there's a date to show
                    dateP.appendChild(dateLabelSpan);
                    dateP.appendChild(dateValueSpan);
                    contentWrapperDiv.appendChild(dateP);
                }

                if (event.time) {
                    const timeP = document.createElement('p');
                    timeP.className = 'text-xl mb-4';
                    const timeLabel = lang === 'fr' ? 'Heure : ' : 'Time: ';
                    const timeValueSpan = document.createElement('span');
                    timeValueSpan.className = 'font-semibold';
                    timeValueSpan.textContent = event.time;
                    timeP.textContent = timeLabel;
                    timeP.appendChild(timeValueSpan);
                    contentWrapperDiv.appendChild(timeP);
                }

                // Location
                if (event.location) {
                    const locTitleP = document.createElement('p');
                    locTitleP.className = 'text-xl mb-4';
                    locTitleP.textContent = lang === 'fr' ? 'Lieu :' : 'Location:';
                    contentWrapperDiv.appendChild(locTitleP);

                    // Create a container for icon and text
                    const locationContainer = document.createElement('div');
                    locationContainer.style.display = 'flex';
                    locationContainer.style.alignItems = 'center';
                    // If locDetailsP had 'mb-4' for block spacing, move it to locationContainer like:
                    // locationContainer.className = 'mb-4'; // Example if locDetailsP was the sole element providing this margin.
                    // For now, assuming the original mb-4 on locTitleP is sufficient or other elements provide block spacing.
                    // If locDetailsP itself (the text part) needs a bottom margin, it should be applied to locationContainer.
                    locationContainer.className = 'mb-4'; // Transferred from locDetailsP

                    // Map Link and Icon (now first in the container)
                    const mapLink = document.createElement('a');
                    mapLink.target = '_blank';
                    mapLink.rel = 'noopener noreferrer';
                    mapLink.style.textDecoration = 'none';
                    // No specific margin on mapLink itself, icon will have marginRight.

                    let mapsHref;
                    if (event.location.mapsLink && event.location.mapsLink.trim() !== "") {
                        mapsHref = event.location.mapsLink;
                    } else {
                        const queryParts = [
                            event.location.name,
                            event.location.address,
                            event.location.city,
                            event.location.province,
                            event.location.postalCode,
                            event.location.country
                        ].filter(part => part && String(part).trim() !== "").join(', ');
                        mapsHref = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(queryParts)}`;
                    }
                    mapLink.href = mapsHref;

                    const mapIcon = document.createElement('i');
                    mapIcon.className = 'fa fa-map-marker';
                    mapIcon.style.color = 'red';
                    mapIcon.style.fontSize = '2.5em';
                    mapIcon.style.marginRight = '10px';
                    mapIcon.setAttribute('aria-hidden', 'true');

                    const ariaLabelText = lang === 'fr' ? 'Voir sur Google Maps' : 'View on Google Maps';
                    mapLink.setAttribute('aria-label', ariaLabelText);
                    mapLink.title = ariaLabelText; // Tooltip for mouse users

                    mapLink.appendChild(mapIcon);
                    locationContainer.appendChild(mapLink); // Icon link is first

                    // Location Text Paragraph (now second in the container)
                    const locDetailsP = document.createElement('p');
                     // Preserve original text styling, but remove mb-4 as container handles it.
                    locDetailsP.className = 'text-lg font-semibold';

                    // Split location text by <br> and append as text nodes and <br> elements
                    const locationParts = (event.location.name + "<br>" + event.location.address + "<br>" + event.location.city + ", " + event.location.province + (event.location.postalCode ? ' ' + event.location.postalCode : '') + (event.location.country && event.location.country.toLowerCase() !== 'canada' ? '<br>' + event.location.country : '')).split('<br>');
                    locationParts.forEach((part, index) => {
                        locDetailsP.appendChild(document.createTextNode(part));
                        if (index < locationParts.length - 1) {
                            locDetailsP.appendChild(document.createElement('br'));
                        }
                    });

                    locationContainer.appendChild(locDetailsP); // Text is second
                    contentWrapperDiv.appendChild(locationContainer); // Add the container to the main content wrapper
                }

                // Description (only if not newbie-training, as its description is handled above or if it's generic)
                // The main description for newbie-training is already rendered above the white box.
                // This part is for other events, or additional description for newbie-training if it were in eventLangData.description
                if (event.id !== 'newbie-training' && eventLangData.description) {
                    const descP = document.createElement('p');
                    descP.className = 'text-lg mb-6';
                    descP.textContent = eventLangData.description;
                    contentWrapperDiv.appendChild(descP);
                }

                // Render new structured fields (cost, equipment, program, notes)
                // These will typically be present for "newbie-training" based on events.json update
                const costLabel = lang === 'fr' ? 'Coût : ' : 'Cost: ';
                if (eventLangData.cost) {
                    const costP = document.createElement('p');
                    costP.className = 'text-xl font-semibold mb-4';
                    costP.textContent = costLabel;
                    const costValueSpan = document.createElement('span');
                    costValueSpan.className = 'font-normal';
                    costValueSpan.textContent = eventLangData.cost;
                    costP.appendChild(costValueSpan);
                    contentWrapperDiv.appendChild(costP);
                }

                const equipmentLabel = lang === 'fr' ? 'Équipement nécessaire : ' : 'Required equipment: ';
                if (eventLangData.equipmentNeeded) {
                    const equipP = document.createElement('p');
                    equipP.className = 'text-xl font-semibold mb-6'; // mb-6 as per original
                    equipP.textContent = equipmentLabel;
                    const equipValueSpan = document.createElement('span');
                    equipValueSpan.className = 'font-normal';
                    equipValueSpan.textContent = eventLangData.equipmentNeeded;
                    equipP.appendChild(equipValueSpan);
                    contentWrapperDiv.appendChild(equipP);
                }

                if (eventLangData.programTitle && eventLangData.programDetails && eventLangData.programDetails.length > 0) {
                    const programTitleEl = document.createElement('h2');
                    programTitleEl.className = 'text-2xl font-bold mb-4 text-gray-800';
                    programTitleEl.textContent = eventLangData.programTitle;
                    contentWrapperDiv.appendChild(programTitleEl);

                    const ul = document.createElement('ul');
                    ul.className = 'list-disc list-inside text-gray-700 space-y-2 mb-6';
                    eventLangData.programDetails.forEach(itemText => {
                        const li = document.createElement('li');
                        li.textContent = itemText;
                        ul.appendChild(li);
                    });
                    contentWrapperDiv.appendChild(ul);
                }

                // Remove the old way of rendering details for newbie-training (which was based on eventLangData.details string)
                // The new fields (programTitle, programDetails, notes) replace the need for parsing eventLangData.details for "newbie-training"

                if (eventLangData.notes) {
                    const notesP = document.createElement('p');
                    notesP.className = 'text-lg italic'; // As per original styling for this type of note
                    notesP.textContent = eventLangData.notes;
                    contentWrapperDiv.appendChild(notesP);
                }


                containerDiv.appendChild(contentWrapperDiv); // Add the white box to the main container

                // URL / Link Button
                if (eventLangData.url) {
                    const linkA = document.createElement('a');
                    linkA.href = eventLangData.url;
                    linkA.target = '_blank';
                    linkA.rel = 'noopener noreferrer';

                    let buttonClasses = 'mt-6 inline-block text-white px-6 py-3 rounded-full font-bold text-lg hover:bg-opacity-80 transition duration-300 shadow-md';
                    let iconClass = 'fa fa-external-link-alt mr-2';
                    let buttonTextContent = lang === 'fr' ? "Voir l'événement" : "View Event";

                    if (eventLangData.url.includes('uwhportal')) {
                        buttonClasses += ' bg-green-600 hover:bg-green-700';
                    } else if (eventLangData.url.includes('facebook')) {
                        buttonClasses += ' bg-blue-600 hover:bg-blue-700';
                         iconClass = 'fa fa-facebook mr-2'; // Update icon class
                         buttonTextContent = lang === 'fr' ? "Voir l'événement Facebook" : "View Facebook Event";
                    } else if (eventLangData.url.startsWith('mailto:')) {
                        buttonClasses += ' bg-gray-800 hover:bg-gray-900';
                        iconClass = 'fa fa-envelope mr-2'; // Update icon class
                        buttonTextContent = lang === 'fr' ? "Envoyez-nous un courriel" : "Email us";

                        if (event.id === 'newbie-training') { // Specific styling for newbie training email button
                             linkA.className = 'mt-4 inline-block bg-gray-800 text-white px-10 py-4 rounded-full font-bold text-xl hover:bg-gray-900 transition duration-300 shadow-lg';
                        } else {
                            linkA.className = buttonClasses;
                        }
                    } else { // Generic fallback
                        buttonClasses += ' bg-gray-500 hover:bg-gray-600';
                    }
                    // Apply classes if not the specific newbie training mailto case
                     if (!(event.id === 'newbie-training' && eventLangData.url.startsWith('mailto:'))) {
                        linkA.className = buttonClasses;
                    }

                    const iconElement = document.createElement('i');
                    iconElement.className = iconClass;
                    linkA.appendChild(iconElement);
                    linkA.appendChild(document.createTextNode(" " + buttonTextContent)); // Add space before text

                    if (event.id === 'newbie-training' && eventLangData.url.startsWith('mailto:')) {
                        const contactP = document.createElement('p');
                        contactP.className = 'text-xl md:text-2xl mt-8 mb-6 font-semibold';
                        contactP.textContent = lang === 'fr' ? "Pour participer ou pour plus d'informations :" : "To participate or for more information:";
                        containerDiv.appendChild(contactP);
                        containerDiv.appendChild(linkA);
                    } else {
                         contentWrapperDiv.appendChild(linkA);
                    }
                }

                section.appendChild(containerDiv);
                return section;
            }

            function renderAllEvents(eventsData) {
                // Clear existing events to prevent duplication if this function is called multiple times
                frenchEventsContainer.innerHTML = '';
                englishEventsContainer.innerHTML = '';

                eventsData.forEach(event => {
                    const frenchEventHtml = renderEvent(event, 'fr');
                    if (frenchEventHtml) frenchEventsContainer.appendChild(frenchEventHtml);

                    const englishEventHtml = renderEvent(event, 'en');
                    if (englishEventHtml) englishEventsContainer.appendChild(englishEventHtml);
                });
            }

            fetch('events.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(eventsData => {
                    renderAllEvents(eventsData);
                    // No need to call setLanguage here, the default language is set by the other script
                    // and it will show the correct container.
                })
                .catch(error => {
                    console.error("Could not load or render events:", error);
                    frenchEventsContainer.innerHTML = '<p class="text-red-500 text-center py-8">Error loading French events.</p>';
                    englishEventsContainer.innerHTML = '<p class="text-red-500 text-center py-8">Error loading English events.</p>';
                });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const bubblesContainer = document.querySelector('.bubbles');

            function createBubble() {
                const bubble = document.createElement('div');
                bubble.classList.add('bubble');

                const size = Math.random() * 40 + 10; // 10px to 50px
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;

                bubble.style.left = `${Math.random() * 100}%`;

                const animationDuration = Math.random() * 10 + 5; // 5s to 15s
                bubble.style.animationDuration = `${animationDuration}s`;

                bubblesContainer.appendChild(bubble);

                setTimeout(() => {
                    bubble.remove();
                }, animationDuration * 1000);
            }

            setInterval(createBubble, 500); // Create a new bubble every 500ms
        });
    </script>
    <script>
        // --- App Logging Configuration (with defaults, will be updated from config.json) ---
        let AppLoggerConfig = {
            enabled: false, // Default to false or a less verbose state like 'warn'
            logLevel: 'warn',
        };

        /**
         * Application logging function.
         * Must be defined after the initial AppLoggerConfig.
         * Logs messages to the console if AppLoggerConfig.enabled is true and the message's
         * level is at or above AppLoggerConfig.logLevel.
         * @param {string} level - The log level (e.g., 'debug', 'info', 'warn', 'error').
         * @param {...any} args - Messages or objects to log.
         */
        function appLog(level, ...args) {
            if (!AppLoggerConfig.enabled) {
                return;
            }

            const levels = ['debug', 'info', 'warn', 'error'];
            const configLevelIndex = levels.indexOf(AppLoggerConfig.logLevel.toLowerCase());
            const messageLevelIndex = levels.indexOf(level.toLowerCase());

            // If the level is not recognized, or if the message level is below the config level, don't log.
            if (messageLevelIndex === -1 || messageLevelIndex < configLevelIndex) {
                return;
            }

            const timestamp = new Date().toISOString();
            let consoleMethod = console.log; // Default to console.log

            // Use specific console methods if they exist (e.g., console.error, console.warn)
            // This also helps them appear with different styling in some browser consoles.
            if (console[level.toLowerCase()] && typeof console[level.toLowerCase()] === 'function') {
                consoleMethod = console[level.toLowerCase()];
            }

            // Prepend timestamp and level to the log arguments
            consoleMethod(`[\${timestamp}] [\${level.toUpperCase()}]`, ...args); // Corrected to use backticks
        }
        // --- End App Logging ---

        async function loadAppConfig() {
            try {
                const response = await fetch('config.json'); // Assuming config.json is in the same directory or accessible via this path
                if (!response.ok) {
                    console.error('Failed to fetch config.json. Status:', response.status, 'Using default AppLoggerConfig.');
                    return;
                }
                const fetchedConfig = await response.json();

                // Update AppLoggerConfig, merging fetched settings with defaults
                if (fetchedConfig.logging) {
                    AppLoggerConfig.enabled = typeof fetchedConfig.logging.enabled === 'boolean' ? fetchedConfig.logging.enabled : AppLoggerConfig.enabled;
                    AppLoggerConfig.logLevel = fetchedConfig.logging.logLevel || AppLoggerConfig.logLevel;
                }

                // Example for other settings (if any were defined in AppLoggerConfig defaults or elsewhere)
                // if (fetchedConfig.otherSettings) { ... }

                // Use console.log here for reliable feedback on what config was loaded,
                // as appLog's behavior depends on this loaded config.
                console.log("AppLoggerConfig after attempting to load config.json:", JSON.parse(JSON.stringify(AppLoggerConfig)));

            } catch (error) {
                console.error('Error loading or parsing config.json:', error, 'Using default AppLoggerConfig.');
            }
        }

        let allClubs = [];
        let currentLanguageClubs = 'en'; // Default language for clubs section
        let selectedSport = 'All';
        let selectedProvince = 'All';

        const provinceTimezones = {
            "Alberta": "America/Edmonton",
            "British Columbia": "America/Vancouver",
            "Manitoba": "America/Winnipeg",
            "New Brunswick": "America/Moncton",
            "Newfoundland and Labrador": "America/St_Johns",
            "Nova Scotia": "America/Halifax",
            "Ontario": "America/Toronto",
            "Prince Edward Island": "America/Halifax",
            "Quebec": "America/Montreal",
            "Saskatchewan": "America/Regina",
            "Northwest Territories": "America/Yellowknife",
            "Nunavut": "America/Iqaluit", // Note: Nunavut has multiple timezones
            "Yukon": "America/Whitehorse"
        };
        const defaultTimezone = "America/Toronto";

        const headersMapClubs = { // Renamed from headersMap to avoid conflict if index.html had similar
            'en': {
                sportType: "Sport Type",
                clubName: "Club Name",
                city: "City",
                practiceTimes: "Practice Times",
                practiceLocationColumn: "Practice Location",
                linksColumn: "Links",
                filterSportTypeLabel: "Filter by Sport Type:",
                filterProvinceLabel: "Filter by Province:",
                allOption: "All",
                AriaDownloadICS: "Download schedule as ICS",
                AriaEmailLink: "Email",
                AriaWebsiteLink: "Visit website",
                AriaFacebookLink: "Visit Facebook page",
                AriaInstagramLink: "Visit Instagram page",
                NotesPrefix: "Notes:"
            },
            'fr': {
                sportType: "Type de sport",
                clubName: "Nom du club",
                city: "Ville",
                practiceTimes: "Heures de pratique",
                practiceLocationColumn: "Lieu de pratique",
                linksColumn: "Liens",
                filterSportTypeLabel: "Filtrer par type de sport :",
                filterProvinceLabel: "Filtrer par province :",
                allOption: "Tous",
                AriaDownloadICS: "Télécharger l'horaire en ICS",
                AriaEmailLink: "Courriel",
                AriaWebsiteLink: "Visiter le site web",
                AriaFacebookLink: "Visiter la page Facebook",
                AriaInstagramLink: "Visiter la page Instagram",
                NotesPrefix: "Remarques:"
            }
        };

        function populateFilterDropdownsClubs(language) { // Renamed
            const filterControlsContainer = document.getElementById('filter-controls');
            if (!filterControlsContainer) {
                console.error('Filter controls container not found!');
                return;
            }
            filterControlsContainer.innerHTML = '';

            const langStrings = headersMapClubs[language];

            const sportTypeLabel = document.createElement('label');
            sportTypeLabel.setAttribute('for', 'sport-type-filter');
            sportTypeLabel.textContent = langStrings.filterSportTypeLabel + ' ';
            filterControlsContainer.appendChild(sportTypeLabel);

            const sportTypeFilter = document.createElement('select');
            sportTypeFilter.id = 'sport-type-filter';
            sportTypeFilter.className = 'text-gray-800'; // Added for visibility on light bg

            const defaultSportOption = document.createElement('option');
            defaultSportOption.value = 'All';
            defaultSportOption.textContent = langStrings.allOption;
            sportTypeFilter.appendChild(defaultSportOption);

            let uniqueSportTypes = [...new Set(allClubs.map(club => club.SportType).filter(st => st))].sort();

            uniqueSportTypes.forEach(sportType => {
                const option = document.createElement('option');
                option.value = sportType;
                const representativeClub = allClubs.find(club => club.SportType === sportType);
                option.textContent = (language === 'fr' && representativeClub && representativeClub.SportTypeFR) ? representativeClub.SportTypeFR : sportType;
                sportTypeFilter.appendChild(option);
            });
            sportTypeFilter.value = selectedSport;
            sportTypeFilter.addEventListener('change', (e) => {
                selectedSport = e.target.value;
                displayClubs(currentLanguageClubs);
            });
            filterControlsContainer.appendChild(sportTypeFilter);
            filterControlsContainer.appendChild(document.createTextNode(' '));

            const provinceLabel = document.createElement('label');
            provinceLabel.setAttribute('for', 'province-filter');
            provinceLabel.textContent = langStrings.filterProvinceLabel + ' ';
            filterControlsContainer.appendChild(provinceLabel);

            const provinceFilter = document.createElement('select');
            provinceFilter.id = 'province-filter';
            provinceFilter.className = 'text-gray-800'; // Added for visibility on light bg
            provinceFilter.innerHTML = '';

            const defaultProvinceOption = document.createElement('option');
            defaultProvinceOption.value = 'All';
            defaultProvinceOption.textContent = langStrings.allOption;
            provinceFilter.appendChild(defaultProvinceOption);

            let uniqueProvinces = [...new Set(allClubs.map(club => club.Province).filter(p => p))].sort();

            uniqueProvinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province;
                const representativeClub = allClubs.find(club => club.Province === province);
                option.textContent = (language === 'fr' && representativeClub && representativeClub.ProvinceFR) ? representativeClub.ProvinceFR : province;
                provinceFilter.appendChild(option);
            });
            provinceFilter.value = selectedProvince;
            provinceFilter.addEventListener('change', (e) => {
                selectedProvince = e.target.value;
                displayClubs(currentLanguageClubs);
            });
            filterControlsContainer.appendChild(provinceFilter);
        }

        async function fetchClubData() {
            const url = 'https://docs.google.com/spreadsheets/d/1Lk8Lq5gu-nI1dwZjWZqYM05-x4E-5kD_huPsW-28AMo/gviz/tq';
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                const jsonString = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                let parsedData;
                try {
                    parsedData = JSON.parse(jsonString);
                } catch (e) {
                    console.error("Error parsing JSON:", e);
                    return;
                }

                const actualHeaders = parsedData.table.rows[0].c.map(cell => (cell && cell.v) ? cell.v : '');
                const headerKeyToIndex = {};
                actualHeaders.forEach((header, index) => {
                    if (header === 'Sport Type') headerKeyToIndex['SportType'] = index;
                    if (header === 'Sport Type FR') headerKeyToIndex['SportTypeFR'] = index;
                    if (header === 'Province') headerKeyToIndex['Province'] = index;
                    if (header === 'Province FR') headerKeyToIndex['ProvinceFR'] = index;
                    if (header === 'Club Name') headerKeyToIndex['ClubName'] = index;
                    if (header === 'Club Name FR') headerKeyToIndex['ClubNameFR'] = index;
                    if (header === 'City') headerKeyToIndex['City'] = index;
                    if (header === 'City FR') headerKeyToIndex['CityFR'] = index;
                    if (header === 'Practice Location') headerKeyToIndex['PracticeLocation'] = index;
                    if (header === 'Practice Location FR') headerKeyToIndex['PracticeLocationFR'] = index;
                    if (header === 'Practice Times') headerKeyToIndex['PracticeTimes'] = index;
                    if (header === 'Contact Email') headerKeyToIndex['ContactEmail'] = index;
                    if (header === 'Website URL') headerKeyToIndex['WebsiteURL'] = index;
                    if (header === 'Facebook URL') headerKeyToIndex['FacebookURL'] = index;
                    if (header === 'Instagram URL') headerKeyToIndex['InstagramURL'] = index;
                    if (header === 'Notes') headerKeyToIndex['Notes'] = index;
                    if (header === 'Notes FR') headerKeyToIndex['NotesFR'] = index;
                    if (header === 'RRULE') headerKeyToIndex['RRULE'] = index;
                    if (header === 'Practice Times FR') headerKeyToIndex['PracticeTimesFR'] = index;
                });

                allClubs = parsedData.table.rows.slice(1).map(row => {
                    const club = {};
                    if (!row || !row.c) return null;
                    for (const key in headerKeyToIndex) {
                        const cell = row.c[headerKeyToIndex[key]];
                        club[key] = (cell && cell.v !== null && cell.v !== undefined) ? cell.v : "";
                    }
                    return club;
                }).filter(club => club !== null);

                console.log("Processed club data:", allClubs);
                displayClubs(currentLanguageClubs);

            } catch (error) {
                console.error("Error fetching club data:", error);
                const clubsContainer = document.getElementById('clubs-container');
                if (clubsContainer) clubsContainer.innerHTML = '<p>Error loading club data. Please try again later.</p>';
                const filterControlsContainer = document.getElementById('filter-controls');
                if (filterControlsContainer) filterControlsContainer.innerHTML = '<p>Could not load filters due to data error.</p>';
            }
        }

        function displayClubs(language) { // Parameter renamed for clarity
            currentLanguageClubs = language; // Use the specific variable for club language

            if (allClubs.length > 0) {
                populateFilterDropdownsClubs(language); // Use renamed function
            } else if (document.getElementById('filter-controls')) {
                 document.getElementById('filter-controls').innerHTML = '';
            }

            const clubsContainer = document.getElementById('clubs-container');
            if (!clubsContainer) {
                console.error('Clubs container not found!');
                return;
            }
            clubsContainer.innerHTML = '';

            const langHeaders = headersMapClubs[language]; // Use renamed map

            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>${langHeaders.clubName}</th>
                        <th>${langHeaders.sportType}</th>
                        <th>${langHeaders.city}</th>
                        <th>${langHeaders.practiceTimes}</th>
                        <th>${langHeaders.practiceLocationColumn}</th>
                        <th>${langHeaders.linksColumn}</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            `;
            const tbody = table.querySelector('tbody');

            let filteredClubs = allClubs;
            if (selectedSport !== 'All') {
                filteredClubs = filteredClubs.filter(club => club.SportType === selectedSport);
            }
            if (selectedProvince !== 'All') {
                filteredClubs = filteredClubs.filter(club => club.Province === selectedProvince);
            }

            if (filteredClubs.length === 0) {
                const colspanCount = table.querySelector('thead tr').children.length;
                tbody.innerHTML = `<tr><td colspan="${colspanCount}" class="no-clubs-message">No clubs match the current filters.</td></tr>`;
                 if (allClubs.length === 0 && !document.getElementById('filter-controls').innerHTML.includes('Could not load filters')) {
                    tbody.innerHTML = `<tr><td colspan="${colspanCount}" class="no-clubs-message">No club data available.</td></tr>`;
                }
            } else {
                filteredClubs.forEach(club => {
                    const tr = document.createElement('tr');

                    const clubName = language === 'fr' ? (club.ClubNameFR || club.ClubName) : club.ClubName;
                    const sportType = language === 'fr' ? (club.SportTypeFR || club.SportType) : club.SportType;
                    const city = language === 'fr' ? (club.CityFR || club.City) : club.City;

                    tr.insertCell().textContent = clubName;
                    tr.insertCell().textContent = sportType;
                    tr.insertCell().textContent = city;

                    const practiceTimesCell = tr.insertCell();
                    let practiceTimeText = club.PracticeTimes;
                    if (language === 'fr' && club.PracticeTimesFR && club.PracticeTimesFR.trim() !== "" && club.PracticeTimesFR.toLowerCase() !== 'na') {
                        practiceTimeText = club.PracticeTimesFR;
                    } else if (!practiceTimeText || practiceTimeText.trim() === "" || practiceTimeText.toLowerCase() === 'na') {
                        practiceTimeText = "NA";
                    }
                    practiceTimesCell.textContent = practiceTimeText;

                    const practiceLocationCell = tr.insertCell();
                    let locationContent = club.PracticeLocation;
                    if (language === 'fr' && club.PracticeLocationFR && club.PracticeLocationFR.trim() !== "" && club.PracticeLocationFR.toLowerCase() !== 'na') {
                        locationContent = club.PracticeLocationFR;
                    } else if (!locationContent || locationContent.trim() === "" || locationContent.toLowerCase() === 'na') {
                        locationContent = "NA";
                    }
                    practiceLocationCell.innerHTML = locationContent;

                    const linksCell = tr.insertCell();
                    const currentClubHeaders = headersMapClubs[currentLanguageClubs]; // Use specific club language

                    const createIconLink = (href, ariaLabelKey, iconClass, isMailto = false) => {
                        const anchor = document.createElement('a');
                        anchor.className = 'link-icon-anchor';
                        if (!isMailto) {
                            anchor.target = '_blank';
                            anchor.rel = 'noopener noreferrer';
                        }
                        anchor.href = href;
                        const ariaLabelText = currentClubHeaders[ariaLabelKey] || "";
                        const fullAriaLabel = href ? `${ariaLabelText} ${href}` : ariaLabelText;
                        anchor.setAttribute('aria-label', fullAriaLabel);

                        const span = document.createElement('span');
                        span.className = 'link-icon';
                        const iconTag = document.createElement('i');
                        iconTag.className = `fa ${iconClass}`;
                        iconTag.setAttribute('aria-hidden', 'true');
                        span.appendChild(iconTag);
                        anchor.appendChild(span);
                        return anchor;
                    };

                    if (club.ContactEmail && club.ContactEmail !== "NA") {
                        linksCell.appendChild(createIconLink(`mailto:${club.ContactEmail}`, 'AriaEmailLink', 'fa-envelope', true));
                    }
                    if (club.WebsiteURL && club.WebsiteURL !== "NA") {
                        linksCell.appendChild(createIconLink(club.WebsiteURL, 'AriaWebsiteLink', 'fa-globe'));
                    }
                    if (club.FacebookURL && club.FacebookURL !== "NA") {
                        linksCell.appendChild(createIconLink(club.FacebookURL, 'AriaFacebookLink', 'fa-facebook-square'));
                    }
                    if (club.InstagramURL && club.InstagramURL !== "NA") {
                        linksCell.appendChild(createIconLink(club.InstagramURL, 'AriaInstagramLink', 'fa-instagram'));
                    }

                    const scheduleButton = document.createElement('button');
                    scheduleButton.className = 'ics-button';
                    scheduleButton.innerHTML = '<i class="fa fa-calendar" aria-hidden="true"></i>';
                    const ariaLabelICS = currentClubHeaders.AriaDownloadICS || "Download schedule as ICS";
                    scheduleButton.setAttribute('aria-label', ariaLabelICS);

                    if (!club.RRULE || club.RRULE.trim() === "" || club.RRULE.toLowerCase() === "na (contact for times)") {
                        scheduleButton.disabled = true;
                        appLog('debug', `ICS button disabled for club: ${club.ClubName || 'Unnamed Club'} due to missing/invalid RRULE.`);
                    } else {
                        scheduleButton.disabled = false;
                        const currentClub = club;

                        scheduleButton.addEventListener("click", () => {
                            appLog('debug', 'ICS button clicked for club (via addEventListener):', currentClub.ClubName);
                            generateICS(currentClub);
                        });

                        appLog('debug', `Attached generateICS listener via addEventListener for club: ${currentClub.ClubName || 'Unnamed Club'}`);
                    }
                    linksCell.appendChild(scheduleButton);

                    if (linksCell.children.length === 0) {
                        linksCell.textContent = "NA";
                    }

                    tbody.appendChild(tr);
                });
            }
            clubsContainer.appendChild(table);
        }

        function formatUTCDate(date) {
            return date.getUTCFullYear() +
                ('0' + (date.getUTCMonth() + 1)).slice(-2) +
                ('0' + date.getUTCDate()).slice(-2) + 'T' +
                ('0' + date.getUTCHours()).slice(-2) +
                ('0' + date.getUTCMinutes()).slice(-2) +
                ('0' + date.getUTCSeconds()).slice(-2) + 'Z';
        }

        function calculateNextDtFromRrule(rruleString, clubPracticeTimeString) {
            const now = new Date();
            let eventDate = new Date(now);

            const dayMap = { 'SU': 0, 'MO': 1, 'TU': 2, 'WE': 3, 'TH': 4, 'FR': 5, 'SA': 6 };

            let targetDay = -1, targetHour = -1, targetMinute = -1;

            const rruleParts = rruleString.split(';');
            rruleParts.forEach(part => {
                const [key, value] = part.split('=');
                if (key === 'BYDAY' && value.length === 2) targetDay = dayMap[value];
                if (key === 'BYHOUR') targetHour = parseInt(value, 10);
                if (key === 'BYMINUTE') targetMinute = parseInt(value, 10);
            });

            if (targetDay === -1 || targetHour === -1 || targetMinute === -1) {
                if (clubPracticeTimeString) {
                    const timeMatch = clubPracticeTimeString.match(/(\d{1,2})[:h](\d{2})?/i);
                    if (timeMatch) {
                        targetHour = parseInt(timeMatch[1], 10);
                        targetMinute = timeMatch[2] ? parseInt(timeMatch[2], 10) : 0;
                        for (const dayKey in dayMap) {
                            if (clubPracticeTimeString.toLowerCase().includes(dayKey.toLowerCase())) {
                                targetDay = dayMap[dayKey];
                                break;
                            }
                        }
                         if (targetDay === -1) targetDay = now.getDay();
                    } else {
                         return null;
                    }
                } else {
                    return null;
                }
            }

            eventDate.setHours(targetHour, targetMinute, 0, 0);

            let daysToAdd = (targetDay - eventDate.getDay() + 7) % 7;
            if (daysToAdd === 0 && eventDate.getTime() < now.getTime()) {
                daysToAdd = 7;
            }
            eventDate.setDate(eventDate.getDate() + daysToAdd);

            const dtstart = new Date(eventDate);
            const dtend = new Date(eventDate);
            dtend.setHours(dtend.getHours() + 1);

            const formatDateForICS = (d) => {
                return d.getFullYear() +
                       ('0' + (d.getMonth() + 1)).slice(-2) +
                       ('0' + d.getDate()).slice(-2) + 'T' +
                       ('0' + d.getHours()).slice(-2) +
                       ('0' + d.getMinutes()).slice(-2) +
                       ('0' + d.getSeconds()).slice(-2);
            };

            return {
                dtstart: formatDateForICS(dtstart),
                dtend: formatDateForICS(dtend)
            };
        }


        function generateICS(club) {
            appLog('debug', 'generateICS called for club:', club);
            const lang = currentLanguageClubs;
            const clubName = lang === 'fr' ? (club.ClubNameFR || club.ClubName) : club.ClubName;
            const sportType = lang === 'fr' ? (club.SportTypeFR || club.SportType) : club.SportType;

            let locationForICS = club.PracticeLocation || "";
            if (currentLanguageClubs === 'fr' && club.PracticeLocationFR && club.PracticeLocationFR.trim() !== "" && club.PracticeLocationFR.toLowerCase() !== "na") {
                locationForICS = club.PracticeLocationFR;
            } else if (!locationForICS || locationForICS.trim() === "" || locationForICS.toLowerCase() === "na") {
                locationForICS = "";
            }

            let practiceTimesForDesc = club.PracticeTimes || "";
            if (currentLanguageClubs === 'fr' && club.PracticeTimesFR && club.PracticeTimesFR.trim() !== "" && club.PracticeTimesFR.toLowerCase() !== "na") {
                practiceTimesForDesc = club.PracticeTimesFR;
            }

            let notesForDesc = club.Notes || "";
            if (currentLanguageClubs === 'fr' && club.NotesFR && club.NotesFR.trim() !== "" && club.NotesFR.toLowerCase() !== "na") {
                notesForDesc = club.NotesFR;
            }

            const currentClubHeaders = headersMapClubs[currentLanguageClubs];
            let description = practiceTimesForDesc.replace(/\r\n|\r|\n/g, "\\n");
            if (notesForDesc) {
                description += `\\n\\n${currentClubHeaders.NotesPrefix} ${notesForDesc.replace(/\r\n|\r|\n/g, "\\n")}`;
            }

            const summary = `${clubName} - ${sportType}`;

            const rruleString = club.RRULE || "";
            if (!rruleString.trim() || rruleString.toLowerCase() === "na (contact for times)") {
                appLog('debug', 'No RRULE found or RRULE is "NA (contact for times)" for club:', clubName);
                alert("No valid recurrence rule found for this club (RRULE is empty or NA).");
                return;
            }
            const individualRrules = rruleString
                .replace(/<br\s*\/?>|&lt;br\s*\/?>/gi, '|')
                .split('|')
                .map(rule => rule.trim())
                .filter(rule => rule.length > 0);

            if (individualRrules.length === 0) {
                appLog('debug', 'No valid individual RRULEs found after parsing for club:', clubName, 'Original RRULE:', club.RRULE);
                alert("No valid individual recurrence rules could be parsed for this club.");
                return;
            }
            appLog('debug', 'About to process individual RRULEs. Count:', individualRrules.length, 'Rules:', individualRrules);


            let icsEvents = [];
            const dtstamp = formatUTCDate(new Date());

            let resolvedTzid = defaultTimezone;
            if (club.Province && provinceTimezones[club.Province]) {
                resolvedTzid = provinceTimezones[club.Province];
            } else if (club.Province) {
                console.warn(`No specific timezone mapping for province: ${club.Province}. Using default: ${defaultTimezone}`);
            }

            for (const rrule of individualRrules) {
                if (rrule.toLowerCase() === "na (contact for times)") continue;

                const dtTimes = calculateNextDtFromRrule(rrule, club.PracticeTimes);
                if (!dtTimes) {
                    console.warn(`Could not calculate DTSTART/DTEND for RRULE: ${rrule}. Skipping this event.`);
                    continue;
                }

                const uid = `${club.ClubName.replace(/[^a-zA-Z0-9]/g, "")}${Date.now()}${Math.random().toString(36).substring(2,5)}@cuga.ca`;

                let eventStr = [
                    'BEGIN:VEVENT',
                    `UID:${uid}`,
                    `DTSTAMP:${dtstamp}`,
                    `SUMMARY:${summary}`,
                    `LOCATION:${locationForICS.replace(/([,;\\])/g, '\\$1').replace(/\r\n|\r|\n/g, "\\n")}`,
                    `DESCRIPTION:${description}`,
                    `RRULE:${rrule}`,
                    `DTSTART;TZID=${resolvedTzid}:${dtTimes.dtstart}`,
                    `DTEND;TZID=${resolvedTzid}:${dtTimes.dtend}`,
                    'END:VEVENT'
                ].join('\r\n');
                icsEvents.push(eventStr);
            }

            if (icsEvents.length === 0) {
                appLog('debug', 'No VEVENTs were created for club:', clubName);
                alert("Could not generate any valid events for this club's schedule (no valid VEVENTs created).");
                return;
            }

            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//CUGA//ClubSchedule//EN',
                ...icsEvents,
                'END:VCALENDAR'
            ].join('\r\n');

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8;' });
            appLog('debug', 'Blob created:', blob);
            const objectURL = URL.createObjectURL(blob);
            appLog('debug', 'Object URL created:', objectURL);

            const link = document.createElement("a");
            link.href = objectURL;
            const fileName = `${clubName.replace(/[^a-zA-Z0-9]/g, "_")}_schedule.ics`;
            link.setAttribute("download", fileName);

            document.body.appendChild(link);
            appLog('debug', 'Link appended to body. About to click download link. Href:', link.href, 'Download attr:', link.download);
            link.click();

            setTimeout(() => {
                appLog('debug', 'link.click() executed for file:', fileName);
                document.body.removeChild(link);
                URL.revokeObjectURL(objectURL);
                appLog('debug', 'Cleanup: Removed temporary link and revoked object URL for club:', clubName);
            }, 100);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await loadAppConfig();
                appLog('info', 'Application configuration loaded successfully.');
            } catch (error) {
                console.error("Critical error during app configuration loading sequence:", error);
                appLog('error', 'Critical error during app configuration loading sequence. Proceeding with default logging.', error);
            }

            fetchClubData();

            const langEnButtonClubs = document.getElementById('lang-en-clubs'); // Updated ID
            const langFrButtonClubs = document.getElementById('lang-fr-clubs'); // Updated ID

            if (langEnButtonClubs) {
                langEnButtonClubs.addEventListener('click', () => {
                    selectedSport = 'All'; // Reset filters
                    selectedProvince = 'All';
                    displayClubs('en');
                });
            }
            if (langFrButtonClubs) {
                langFrButtonClubs.addEventListener('click', () => {
                    selectedSport = 'All'; // Reset filters
                    selectedProvince = 'All';
                    displayClubs('fr');
                });
            }
        });
    </script>
</body>
</html>
