<!DOCTYPE html>
<html lang="fr"> <!-- Default language set to French -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demande d'adhésion et décharge CUGA / CUGA Membership Application and Waiver</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="assets/fontawesome/css/font-awesome.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T2BEK56YJ1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-T2BEK56YJ1');
    </script>
    <meta name="description" content="Formulaire de demande d'adhésion et de décharge CUGA. CUGA Membership Application and Waiver Form.">
    <meta name="keywords" content="CUGA, waiver, décharge, membership, adhésion, application, demande, underwater sports, sports subaquatiques, Canada, Canadian Underwater Games Association">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .lang-en, .lang-fr-inline { display: none; } /* Hide English by default, and French inline for JS control */
        .hidden { display: none; }
    </style>
</head>
<body class="bg-blue-700 text-white">

    <header class="bg-[#386DC0] text-white py-8 text-center shadow-lg">
        <img src="assets/logos/CUGA/Horizontal/EN/FullColor/CUGA-logo-h-en-fullColor-rgb.svg" alt="CUGA Logo" class="h-12 mx-auto">
        <p class="mt-1 text-md md:text-lg italic">
            <span class="lang-fr">Décharge d'adhésion CUGA</span>
            <span class="lang-en">CUGA Membership Waiver</span>
        </p>
    </header>

    <div class="text-center py-4 bg-gray-200">
        <button class="lang-button px-4 py-2 mr-2 rounded bg-blue-500 text-white" data-lang="fr">
            <i class="fa fa-fleur-de-lis"></i> Français
        </button>
        <button class="lang-button px-4 py-2 rounded bg-gray-400 text-gray-800" data-lang="en">
            <i class="fa fa-canadian-maple-leaf"></i> English
        </button>
    </div>

    <main class="container mx-auto px-4 py-16">
        <div class="bg-white text-gray-800 rounded-xl shadow-xl p-8 md:p-12">
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-8 text-blue-800">
                <span class="lang-fr">Demande d'adhésion et décharge</span>
                <span class="lang-en">Membership Application and Waiver</span>
            </h1>
            <form id="waiverForm">
                <!-- Personal Information Section -->
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">
                        <span class="lang-fr">Informations personnelles</span>
                        <span class="lang-en">Personal Information</span>
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="fullName" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Nom complet</span><span class="lang-en">Full Name</span>
                            </label>
                            <input type="text" name="fullName" id="fullName" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Adresse courriel</span><span class="lang-en">Email Address</span>
                            </label>
                            <input type="email" name="email" id="email" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="dob" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Date de naissance</span><span class="lang-en">Date of Birth</span>
                            </label>
                            <input type="date" name="dob" id="dob" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Numéro de téléphone</span><span class="lang-en">Phone Number</span>
                            </label>
                            <input type="tel" name="phone" id="phone" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>
                    <div class="mt-6">
                        <label for="address" class="block text-sm font-medium text-gray-700">
                            <span class="lang-fr">Adresse municipale</span><span class="lang-en">Street Address</span>
                        </label>
                        <input type="text" name="address" id="address" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div>
                            <label for="city" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Ville</span><span class="lang-en">City</span>
                            </label>
                            <input type="text" name="city" id="city" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="province" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Province/Territoire</span><span class="lang-en">Province/Territory</span>
                            </label>
                            <input type="text" name="province" id="province" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="postalCode" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Code postal</span><span class="lang-en">Postal Code</span>
                            </label>
                            <input type="text" name="postalCode" id="postalCode" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div>
                            <label for="emergencyContactName" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Nom du contact d'urgence</span><span class="lang-en">Emergency Contact Name</span>
                            </label>
                            <input type="text" name="emergencyContactName" id="emergencyContactName" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="emergencyContactPhone" class="block text-sm font-medium text-gray-700">
                                <span class="lang-fr">Téléphone du contact d'urgence</span><span class="lang-en">Emergency Contact Phone</span>
                            </label>
                            <input type="tel" name="emergencyContactPhone" id="emergencyContactPhone" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>
                </div>

                <!-- Membership Type Section -->
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">
                        <span class="lang-fr">Type d'adhésion</span><span class="lang-en">Membership Type</span>
                    </h2>
                    <div>
                        <label for="membershipType" class="block text-sm font-medium text-gray-700">
                            <span class="lang-fr">Sélectionnez la catégorie d'adhésion</span><span class="lang-en">Select Membership Category</span>
                        </label>
                        <select id="membershipType" name="membershipType" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="">-- <span class="lang-fr">Veuillez choisir une option</span><span class="lang-en">Please choose an option</span> --</option>
                            <option value="adult"><span class="lang-fr">Adulte</span><span class="lang-en">Adult</span></option>
                            <option value="youth_u18"><span class="lang-fr">Jeune (-18 ans)</span><span class="lang-en">Youth (<18 years)</span></option>
                            <option value="youth_18_24"><span class="lang-fr">Jeune (18-24 ans)</span><span class="lang-en">Youth (18-24 years)</span></option>
                            <option value="new_player"><span class="lang-fr">Nouveau joueur (Première année)</span><span class="lang-en">New Player (First Year)</span></option>
                        </select>
                    </div>
                    <div id="calculatedFee" class="mt-4 text-xl font-semibold text-gray-800">
                        <span class="lang-fr-inline">Frais calculés :</span><span class="lang-en-inline">Calculated Fee:</span> $0.00
                    </div>
                </div>

                <!-- Agreements Section -->
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">
                        <span class="lang-fr">Accords et décharges</span><span class="lang-en">Agreements and Waivers</span>
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input id="agreeCodeOfConduct" name="agreeCodeOfConduct" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="agreeCodeOfConduct" class="font-medium text-gray-700">
                                    <span class="lang-fr">J'ai lu et j'accepte le <a href="join.html#code-of-conduct-link-fr" target="_blank" class="text-blue-600 hover:underline">Code de conduite de CUGA</a>.</span>
                                    <span class="lang-en">I have read and agree to the <a href="join.html#code-of-conduct-link-en" target="_blank" class="text-blue-600 hover:underline">CUGA Code of Conduct</a>.</span>
                                </label>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input id="agreeWaiverTerms" name="agreeWaiverTerms" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="agreeWaiverTerms" class="font-medium text-gray-700">
                                    <span class="lang-fr">J'ai lu et j'accepte les termes de la <a href="join.html#adult-waiver-link-fr" target="_blank" class="text-blue-600 hover:underline">décharge CUGA applicable</a>.</span>
                                    <span class="lang-en">I have read and agree to the terms of the <a href="join.html#adult-waiver-link-en" target="_blank" class="text-blue-600 hover:underline">applicable CUGA Waiver</a>.</span>
                                </label>
                            </div>
                        </div>
                        <div class="pl-8 space-y-1">
                             <p class="text-sm text-gray-600">
                                <span class="lang-fr">Veuillez consulter les documents de décharge pertinents :</span>
                                <span class="lang-en">Please review the relevant waiver documents:</span>
                             </p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>
                                    <a href="join.html#adult-waiver-link-fr" target="_blank" class="text-blue-600 hover:underline lang-fr">Décharge Adulte (Voir/Télécharger)</a>
                                    <a href="join.html#adult-waiver-link-en" target="_blank" class="text-blue-600 hover:underline lang-en">Adult Waiver (View/Download)</a>
                                </li>
                                <li>
                                    <a href="join.html#minor-waiver-link-fr" target="_blank" class="text-blue-600 hover:underline lang-fr">Décharge Mineur (Voir/Télécharger)</a>
                                    <a href="join.html#minor-waiver-link-en" target="_blank" class="text-blue-600 hover:underline lang-en">Minor Waiver (View/Download)</a>
                                    - <span class="lang-fr">Pour les participants de moins de 18 ans.</span><span class="lang-en">For participants under 18.</span>
                                </li>
                                 <li>
                                    <a href="join.html#printable-waivers" target="_blank" class="text-blue-600 hover:underline lang-fr">Toutes les décharges imprimables (PDF combiné)</a>
                                    <a href="join.html#printable-waivers" target="_blank" class="text-blue-600 hover:underline lang-en">All Printable Waivers (Combined PDF)</a>
                                 </li>
                            </ul>
                            <p class="text-xs text-gray-500 mt-1">
                                <span class="lang-fr">Note : Pour les membres de moins de 18 ans, un parent ou tuteur légal doit également consentir aux termes et signer la décharge pour mineur.</span>
                                <span class="lang-en">Note: For members under 18, a parent or guardian must also consent to the terms and sign the Minor Waiver.</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">
                        <span class="lang-fr">Signature numérique</span><span class="lang-en">Digital Signature</span>
                    </h2>
                     <p class="text-sm text-gray-600 mb-2">
                        <span class="lang-fr">En tapant votre nom complet ci-dessous, vous reconnaissez et acceptez tous les termes et conditions décrits dans cette demande et les décharges associées.</span>
                        <span class="lang-en">By typing your full name below, you acknowledge and agree to all terms and conditions outlined in this application and the associated waivers.</span>
                     </p>
                    <p class="text-sm text-gray-600 mb-4"><strong>
                        <span class="lang-fr">Pour les membres de moins de 18 ans :</span><span class="lang-en">For members under 18:</span></strong>
                        <span class="lang-fr">Cette section doit être complétée par un parent ou tuteur légal.</span>
                        <span class="lang-en">This section must be completed by a parent or legal guardian.</span>
                    </p>
                    <div>
                        <label for="digitalSignature" class="block text-sm font-medium text-gray-700">
                            <span class="lang-fr">Nom complet du demandeur (ou parent/tuteur si moins de 18 ans)</span>
                            <span class="lang-en">Full Name of Applicant (or Parent/Guardian if under 18)</span>
                        </label>
                        <input type="text" name="digitalSignature" id="digitalSignature" required
                               placeholder-lang-fr="Tapez votre nom complet"
                               placeholder-lang-en="Type your full name"
                               class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                     <div class="mt-4">
                        <label for="signatureDate" class="block text-sm font-medium text-gray-700">Date</label>
                        <input type="date" name="signatureDate" id="signatureDate" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>

                <button type="button" id="googlePayButton" class="mt-6 w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" class="mr-2"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm-1 14H5c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h14c.55 0 1 .45 1 1v10c0 .55-.45 1-1 1z" fill="#fff"/><path d="M10.94 15.26c.14.44.54.74 1.06.74.62 0 1.08-.44 1.08-1.03 0-.66-.5-1.03-1.27-1.03h-.6v-1.36h.57c.58 0 .98-.34.98-.87 0-.52-.4-.84-.96-.84-.47 0-.83.28-.98.64l-1.27-.52c.25-.76.92-1.37 1.99-1.37.93 0 1.84.57 1.84 1.57 0 .6-.34 1.05-.84 1.32v.07c.57.17.98.67.98 1.41 0 1.06-.89 1.8-2.12 1.8-.94 0-1.66-.53-1.93-1.33l1.25-.5zM20.57 10h-2.48V9.18h2.48V10zm0 1.48h-2.48v2.71c0 .76-.54 1.08-1.18 1.08-.6 0-1.04-.31-1.04-.97V11.48H13.4v3.61c0 1.21.79 1.93 1.93 1.93.87 0 1.44-.39 1.72-.71h.07v.6h1.38V11.48zM7.36 13.16c0-.5.34-.76.76-.76s.76.26.76.76v3.12h1.43V12.4c0-1.08-.78-1.64-1.93-1.64s-1.94.56-1.94 1.64v3.88h1.43v-3.12z" fill="#fff"/></svg>
                    <span class="lang-fr">Payer avec Google Pay</span><span class="lang-en">Pay with Google Pay</span>
                </button>
            </form>

            <div id="submissionResult" class="hidden mt-8 p-6 bg-green-100 border border-green-400 text-green-700 rounded-md">
                <p id="submissionMessageText" class="text-center text-lg"></p>
                <div class="mt-6 text-center space-x-0 space-y-4 md:space-y-0 md:space-x-4">
                    <button type="button" id="newApplicationButton" class="w-full md:w-auto px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <span class="lang-fr">Commencer une nouvelle demande</span>
                        <span class="lang-en">Start New Application</span>
                    </button>
                    <a href="index.html" class="w-full md:w-auto inline-block px-6 py-3 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
                        <span class="lang-fr">Aller à la page d'accueil</span>
                        <span class="lang-en">Go to Homepage</span>
                    </a>
                </div>
            </div>

        </div>
    </main>

    <footer class="bg-gray-900 text-gray-400 py-8 text-center">
        <div class="container mx-auto px-4">
            <p>&copy; 2025 CUGA. <span class="lang-fr">Tous droits réservés.</span><span class="lang-en">All rights reserved.</span></p>
            <p class="mt-4">
                <a href="privacy-policy.html" class="text-blue-400 hover:underline lang-fr">Politique de Confidentialité</a>
                <a href="privacy-policy.html" class="text-blue-400 hover:underline lang-en">Privacy Policy</a> |
                <a href="terms-of-use.html" class="text-blue-400 hover:underline lang-fr">Conditions d'Utilisation</a>
                <a href="terms-of-use.html" class="text-blue-400 hover:underline lang-en">Terms of Use</a>
            </p>
        </div>
    </footer>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            AOS.init({ duration: 1000, once: true });

            const langButtons = document.querySelectorAll('.lang-button');
            const htmlTag = document.documentElement;

            function updateDisplayedLanguage(lang) {
                htmlTag.lang = lang;
                document.querySelectorAll('.lang-fr, .lang-en, .lang-fr-inline, .lang-en-inline').forEach(el => {
                    if (el.classList.contains(`lang-${lang}`) || el.classList.contains(`lang-${lang}-inline`)) {
                        el.style.display = el.classList.contains('lang-fr-inline') || el.classList.contains('lang-en-inline') ? 'inline' : 'block';
                    } else {
                        el.style.display = 'none';
                    }
                });
                langButtons.forEach(button => {
                    button.classList.toggle('bg-blue-600', button.dataset.lang === lang);
                    button.classList.toggle('text-white', button.dataset.lang === lang);
                    button.classList.toggle('bg-gray-400', button.dataset.lang !== lang);
                    button.classList.toggle('text-gray-800', button.dataset.lang !== lang);
                });

                // Update placeholder for digital signature based on language
                const digitalSignatureInput = document.getElementById('digitalSignature');
                if (digitalSignatureInput) {
                    digitalSignatureInput.placeholder = lang === 'fr' ? digitalSignatureInput.getAttribute('placeholder-lang-fr') : digitalSignatureInput.getAttribute('placeholder-lang-en');
                }
                // Update membership options text (if needed, though CSS might handle this better with :lang pseudo-class if options were structured differently)
                 // For select options, direct text manipulation is tricky. The current span approach inside option tags is non-standard.
                 // A better way would be to rebuild options or use CSS :lang if possible, but for now, we'll rely on the initial setup
                 // and the fact that the *value* is what matters for JS logic. The bilingual text in one line is a compromise.
            }

            const browserLang = (navigator.language || navigator.userLanguage || 'fr').slice(0, 2);
            const initialLang = browserLang === 'en' ? 'en' : 'fr';
            updateDisplayedLanguage(initialLang);

            langButtons.forEach(button => {
                button.addEventListener('click', () => updateDisplayedLanguage(button.dataset.lang));
            });

            const membershipTypeSelect = document.getElementById('membershipType');
            const calculatedFeeDiv = document.getElementById('calculatedFee');
            const googlePayButton = document.getElementById('googlePayButton');
            const waiverForm = document.getElementById('waiverForm');
            const submissionResultDiv = document.getElementById('submissionResult');
            const submissionMessageText = document.getElementById('submissionMessageText');
            const newApplicationButton = document.getElementById('newApplicationButton');

            let currentFee = 0;

            const fees = {
                adult: { early: 45, regular: 90 },
                youth_u18: { early: 0, regular: 0 },
                youth_18_24: { early: 15, regular: 30 },
                new_player: { early: 0, regular: 0 }
            };
            const earlyBirdCutoff = new Date(new Date().getFullYear(), 2, 1); // March 1st

            const messages = {
                validationError: {
                    en: "Please fill out all required fields before proceeding.",
                    fr: "Veuillez remplir tous les champs obligatoires avant de continuer."
                },
                zeroFeeSuccess: {
                    en: "Membership fee is $0. Registration will now be completed (simulation)!",
                    fr: "Les frais d'adhésion sont de 0 $. L'inscription va maintenant être complétée (simulation) !"
                },
                paymentSimulation: {
                    en: "Simulating Google Pay... Payment of ${amount} successful (simulation)!",
                    fr: "Simulation de Google Pay... Paiement de ${amount} $ réussi (simulation) !"
                },
                submissionSuccess: {
                    en: "Your application has been submitted (simulated). Data logged to console. You will receive a confirmation email shortly.",
                    fr: "Votre demande a été soumise (simulation). Données enregistrées dans la console. Vous recevrez un courriel de confirmation sous peu."
                }
            };

            function calculateFee() {
                const selectedType = membershipTypeSelect.value;
                const currentDate = new Date();
                let fee = 0;
                if (selectedType && fees[selectedType]) {
                    fee = (currentDate < earlyBirdCutoff) ? fees[selectedType].early : fees[selectedType].regular;
                }
                currentFee = fee;
                const lang = htmlTag.lang || 'fr';
                const feeText = lang === 'fr' ? 'Frais calculés :' : 'Calculated Fee:';
                calculatedFeeDiv.innerHTML = `<span class="lang-${lang}-inline">${feeText}</span> $${currentFee.toFixed(2)}`;
                // Ensure correct span is visible
                document.querySelectorAll('#calculatedFee .lang-fr-inline, #calculatedFee .lang-en-inline').forEach(el => el.style.display = 'none');
                document.querySelector(`#calculatedFee .lang-${lang}-inline`).style.display = 'inline';
                return currentFee;
            }

            function handleFormSubmission(isZeroFee, paymentAmount) {
                const formData = new FormData(waiverForm);
                const data = {};
                formData.forEach((value, key) => { data[key] = value; });
                data['calculatedFee'] = currentFee.toFixed(2);
                data['timestamp'] = new Date().toISOString();

                console.log("Simulating data submission to Google Drive:", data);

                const lang = htmlTag.lang || 'fr';
                let messageEn, messageFr;

                if(isZeroFee) {
                    messageEn = messages.zeroFeeSuccess.en;
                    messageFr = messages.zeroFeeSuccess.fr;
                } else if (paymentAmount > 0) {
                    messageEn = messages.paymentSimulation.en.replace('${amount}', paymentAmount.toFixed(2));
                    messageFr = messages.paymentSimulation.fr.replace('${amount}', paymentAmount.toFixed(2));
                }
                // Prepend payment message to general submission success message
                const finalMessageEn = (paymentAmount > 0 || isZeroFee ? messageEn + "<br><br>" : "") + messages.submissionSuccess.en;
                const finalMessageFr = (paymentAmount > 0 || isZeroFee ? messageFr + "<br><br>" : "") + messages.submissionSuccess.fr;

                submissionMessageText.innerHTML = `<span class="lang-en">${finalMessageEn}</span><span class="lang-fr">${finalMessageFr}</span>`;

                updateDisplayedLanguage(lang); // Ensure correct part of submissionMessageText is shown

                submissionResultDiv.classList.remove('hidden');
                googlePayButton.classList.add('hidden'); // Hide pay button
                document.querySelector('#waiverForm > div:not(:last-child)').classList.add('hidden'); // Hide form fields sections
                document.querySelector('h1').classList.add('hidden'); // Hide main title

                waiverForm.reset();
                calculateFee();
            }

            if (membershipTypeSelect && calculatedFeeDiv && googlePayButton && waiverForm && submissionResultDiv && newApplicationButton) {
                membershipTypeSelect.addEventListener('change', calculateFee);
                calculateFee(); // Initial calculation

                googlePayButton.addEventListener('click', () => {
                    calculateFee();
                    const lang = htmlTag.lang || 'fr';

                    if (!waiverForm.checkValidity()) {
                        alert(messages.validationError[lang]);
                        waiverForm.reportValidity();
                        return;
                    }

                    if (currentFee === 0) {
                        console.log("Membership fee is $0. Proceeding with registration.");
                        handleFormSubmission(true, 0);
                    } else {
                        console.log(`Simulating Google Pay for fee: $${currentFee.toFixed(2)}`);
                        handleFormSubmission(false, currentFee);
                    }
                });

                newApplicationButton.addEventListener('click', () => {
                    submissionResultDiv.classList.add('hidden');
                    googlePayButton.classList.remove('hidden');
                    document.querySelector('#waiverForm > div:not(:last-child)').classList.remove('hidden'); // Show form fields sections
                     document.querySelector('h1').classList.remove('hidden'); // Show main title
                    waiverForm.reset();
                    calculateFee();
                    updateDisplayedLanguage(htmlTag.lang || 'fr'); // Refresh language specific elements
                });
            } else {
                console.error("Required elements for waiver form, fee calculation, or submission process not found.");
            }
        });
    </script>
</body>
</html>
